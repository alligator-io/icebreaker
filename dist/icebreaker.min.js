(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.icebreaker=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var pull=require("pull-stream");var inherits=require("inherits");var isArray=require("isarray");function init(){if(arguments.length>0){for(var key in arguments){if(arguments.hasOwnProperty(key)){var arg=arguments[key];if(isArray(arg)||typeof arg==="string"||typeof arg==="number"){if(this._chain===false)this._commands.push(this.params(arg));else this.params(arg)}else this._commands.push(arg)}}if(this._chain===false){return this.pull()}}}function icebreaker(){if(!(this instanceof icebreaker)){var i=Object.create(icebreaker.prototype);var p=icebreaker.apply(i,[].slice.call(arguments));if(p)return p;return i}this._commands=[];if(this._chain==null)this._chain=false;var p=init.apply(this,[].slice.call(arguments));if(p)return p}icebreaker.prototype.add=function(){this._commands=this._commands.concat([].slice.call(arguments));return this};var mixin=icebreaker.mixin=function(obj,dest){if(!dest)dest=icebreaker;for(var key in obj){if(obj.hasOwnProperty(key)){var value=obj[key];if(typeof value==="function"&&typeof key==="string"){(function(key,value){dest[key]=function(){return value.apply(this,[].slice.call(arguments))};dest.prototype[key]=function(){var r=dest[key].apply(this,[].slice.call(arguments));return this._chain===true?this.add(r):r}})(key,value)}else if(typeof value==="object"&&key!=="prototype"){(function(key,value){dest[key]=value;var w=function(){if(!(this instanceof w))return new w;icebreaker.call(this)};inherits(w,icebreaker);if(Object.keys(value).length>0)icebreaker.mixin(value,w);else{dest[key]=w}dest.prototype[key]=function(){var s=new w;s._commands=this._commands;s._chain=this._chain;return s}})(key,value)}}}};icebreaker.prototype.pull=function(){if(isArray(this._commands))for(var key in this._commands){if(this._commands[key]instanceof icebreaker){var r=this._commands[key].pull();if(r)this._commands[key]=r}}var p=pull.apply(pull,this._commands);this._commands=[];return p};mixin(pull);mixin({fork:require("pull-fork"),pair:require("pull-pair"),source:pull.Source,through:pull.Through,sink:icebreaker.Sink,chain:function(){if(!(this instanceof icebreaker)){var i=Object.create(icebreaker.prototype);i._chain=true;icebreaker.apply(i,[].slice.call(arguments));return i}this._chain=true;init.apply(this,[].slice.call(arguments));return this},params:function(){return icebreaker.chain().values([].slice.call(arguments)).map(function(arg){if(!isArray(arg))return[arg];return arg}).flatten().pull()},cleanup:function(func){return function(read){var ended;return function(abort,callback){read(abort,function next(end,data){if(ended)return;if(end){func(end);return callback(ended=end)}callback(end,data)})}}}});module.exports=icebreaker},{inherits:3,isarray:4,"pull-fork":5,"pull-pair":6,"pull-stream":7}],2:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],3:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],4:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],5:[function(require,module,exports){"use strict";module.exports=function(sinks,select,create){if("function"===typeof sinks){create=select;select=sinks;sinks=[]}var running=0;var cbs=new Array(sinks.length);var aborted=new Array(sinks.length);var open=false,ended,j,data,read,reading;function init(key,reader){running++;reader(function(abort,cb){if(abort){aborted[key]=abort;--running;if(j===key)j=null;pull(running?null:abort);if(cb)cb(abort);return}if(j===key){var _j=j;j=null;if(aborted[key])return;cb(null,data)}else if(ended){return cb(ended)}else{cbs[key]=cb}pull()})}for(var k in sinks)init(k,sinks[k]);function endAll(){for(var k in cbs){if(cbs[k]){var cb=cbs[k];cbs[k]=null;cb(ended)}}}function pull(abort){if(reading||!read||j!=null)return;reading=true;read(abort,function(end,_data){reading=false;var _j;if(end){ended=end;return endAll()}else _j=select(_data,sinks);if(aborted[_j])return pull();if(!sinks[_j]){sinks[_j]=create(_j,sinks);j=_j;data=_data;return init(_j,sinks[_j])}if(cbs[_j]){var cb=cbs[_j];cbs[_j]=null;cb(null,_data)}else{j=_j;data=_data}})}function reader(_read){read=_read;pull()}reader.add=function(key,sink){sinks[key]=sink;init(key,sink)};return reader}},{}],6:[function(require,module,exports){module.exports=function(){var _read,waiting;function sink(read){if("function"!==typeof read)throw new Error("read must be function");_read=read;if(waiting){var _waiting=waiting;waiting=null;_read.apply(null,_waiting)}}function source(abort,cb){if(_read)_read(abort,cb);else waiting=[abort,cb]}return{source:source,sink:sink}}},{}],7:[function(require,module,exports){var sources=require("./sources");var sinks=require("./sinks");var throughs=require("./throughs");var u=require("pull-core");function isFunction(fun){return"function"===typeof fun}function isReader(fun){return fun&&(fun.type==="Through"||fun.length===1)}var exports=module.exports=function pull(){var args=[].slice.call(arguments);if(isReader(args[0]))return function(read){args.unshift(read);return pull.apply(null,args)};var read=args.shift();if(isFunction(read.source))read=read.source;function next(){var s=args.shift();if(null==s)return next();if(isFunction(s))return s;return function(read){s.sink(read);return s.source}}while(args.length)read=next()(read);return read};for(var k in sources)exports[k]=u.Source(sources[k]);for(var k in throughs)exports[k]=u.Through(throughs[k]);for(var k in sinks)exports[k]=u.Sink(sinks[k]);var maybe=require("./maybe")(exports);for(var k in maybe)exports[k]=maybe[k];exports.Duplex=exports.Through=exports.pipeable=u.Through;exports.Source=exports.pipeableSource=u.Source;exports.Sink=exports.pipeableSink=u.Sink},{"./maybe":8,"./sinks":10,"./sources":11,"./throughs":12,"pull-core":9}],8:[function(require,module,exports){var u=require("pull-core");var prop=u.prop;var id=u.id;var maybeSink=u.maybeSink;module.exports=function(pull){var exports={};var drain=pull.drain;var find=exports.find=function(test,cb){return maybeSink(function(cb){var ended=false;if(!cb)cb=test,test=id;else test=prop(test)||id;return drain(function(data){if(test(data)){ended=true;cb(null,data);return false}},function(err){if(ended)return;cb(err===true?null:err,null)})},cb)};var reduce=exports.reduce=function(reduce,acc,cb){return maybeSink(function(cb){return drain(function(data){acc=reduce(acc,data)},function(err){cb(err,acc)})},cb)};var collect=exports.collect=exports.writeArray=function(cb){return reduce(function(arr,item){arr.push(item);return arr},[],cb)};var concat=exports.concat=function(cb){return reduce(function(a,b){return a+b},"",cb)};return exports}},{"pull-core":9}],9:[function(require,module,exports){exports.id=function(item){return item};exports.prop=function(map){if("string"==typeof map){var key=map;return function(data){return data[key]}}return map};exports.tester=function(test){if(!test)return exports.id;if("object"===typeof test&&"function"===typeof test.test)return test.test.bind(test);return exports.prop(test)||exports.id};exports.addPipe=addPipe;function addPipe(read){if("function"!==typeof read)return read;read.pipe=read.pipe||function(reader){if("function"!=typeof reader)throw new Error("must pipe to reader");return addPipe(reader(read))};read.type="Source";return read}var Source=exports.Source=function Source(createRead){function s(){var args=[].slice.call(arguments);return addPipe(createRead.apply(null,args))}s.type="Source";return s};var Through=exports.Through=function(createRead){return function(){var args=[].slice.call(arguments);var piped=[];function reader(read){args.unshift(read);read=createRead.apply(null,args);while(piped.length)read=piped.shift()(read);return read}reader.pipe=function(read){piped.push(read);if(read.type==="Source")throw new Error("cannot pipe "+reader.type+" to Source");reader.type=read.type==="Sink"?"Sink":"Through";return reader};reader.type="Through";return reader}};var Sink=exports.Sink=function Sink(createReader){return function(){var args=[].slice.call(arguments);if(!createReader)throw new Error("must be createReader function");function s(read){args.unshift(read);return createReader.apply(null,args)}s.type="Sink";return s}};exports.maybeSink=exports.maybeDrain=function(createSink,cb){if(!cb)return Through(function(read){var ended;return function(close,cb){if(close)return read(close,cb);if(ended)return cb(ended);createSink(function(err,data){ended=err||true;if(!err)cb(null,data);else cb(ended)})(read)}})();return Sink(function(read){return createSink(cb)(read)})()}},{}],10:[function(require,module,exports){var drain=exports.drain=function(read,op,done){(function next(){var loop=true,cbed=false;while(loop){cbed=false;read(null,function(end,data){cbed=true;if(end){loop=false;if(done)done(end===true?null:end);else if(end&&end!==true)throw end}else if(op&&false===op(data)){loop=false;read(true,done||function(){})}else if(!loop){next()}});if(!cbed){loop=false;return}}})()};var onEnd=exports.onEnd=function(read,done){return drain(read,null,done)};var log=exports.log=function(read,done){return drain(read,function(data){console.log(data)},done)}},{}],11:[function(require,module,exports){var keys=exports.keys=function(object){return values(Object.keys(object))};var once=exports.once=function(value){return function(abort,cb){if(abort)return cb(abort);if(value!=null){var _value=value;value=null;cb(null,_value)}else cb(true)}};var values=exports.values=exports.readArray=function(array){if(!Array.isArray(array))array=Object.keys(array).map(function(k){return array[k]});var i=0;return function(end,cb){if(end)return cb&&cb(end);cb(i>=array.length||null,array[i++])}};var count=exports.count=function(max){var i=0;max=max||Infinity;return function(end,cb){if(end)return cb&&cb(end);if(i>max)return cb(true);cb(null,i++)}};var infinite=exports.infinite=function(generate){generate=generate||Math.random;return function(end,cb){if(end)return cb&&cb(end);return cb(null,generate())}};var defer=exports.defer=function(){var _read,cbs=[],_end;var read=function(end,cb){if(!_read){_end=end;cbs.push(cb)}else _read(end,cb)};read.resolve=function(read){if(_read)throw new Error("already resolved");_read=read;if(!_read)throw new Error("no read cannot resolve!"+_read);while(cbs.length)_read(_end,cbs.shift())};read.abort=function(err){read.resolve(function(_,cb){cb(err||true)})};return read};var empty=exports.empty=function(){return function(abort,cb){cb(true)}};var error=exports.error=function(err){return function(abort,cb){cb(err)}};var depthFirst=exports.depthFirst=function(start,createStream){var reads=[];reads.unshift(once(start));return function next(end,cb){if(!reads.length)return cb(true);reads[0](end,function(end,data){if(end){reads.shift();return next(null,cb)}reads.unshift(createStream(data));cb(end,data)})}};var widthFirst=exports.widthFirst=function(start,createStream){var reads=[];reads.push(once(start));return function next(end,cb){if(!reads.length)return cb(true);reads[0](end,function(end,data){if(end){reads.shift();return next(null,cb)}reads.push(createStream(data));cb(end,data)})}};var leafFirst=exports.leafFirst=function(start,createStream){var reads=[];var output=[];reads.push(once(start));return function next(end,cb){reads[0](end,function(end,data){if(end){reads.shift();if(!output.length)return cb(true);return cb(null,output.shift())}reads.unshift(createStream(data));output.unshift(data);next(null,cb)})}}},{}],12:[function(require,module,exports){(function(process){var u=require("pull-core");var sources=require("./sources");var sinks=require("./sinks");var prop=u.prop;var id=u.id;var tester=u.tester;var map=exports.map=function(read,map){map=prop(map)||id;return function(abort,cb){read(abort,function(end,data){try{data=!end?map(data):null}catch(err){return read(err,function(){return cb(err)})}cb(end,data)})}};var asyncMap=exports.asyncMap=function(read,map){if(!map)return read;return function(end,cb){if(end)return read(end,cb);read(null,function(end,data){if(end)return cb(end,data);map(data,cb)})}};var paraMap=exports.paraMap=function(read,map,width){if(!map)return read;var ended=false,queue=[],_cb;function drain(){if(!_cb)return;var cb=_cb;_cb=null;if(queue.length)return cb(null,queue.shift());else if(ended&&!n)return cb(ended);_cb=cb}function pull(){read(null,function(end,data){if(end){ended=end;return drain()}n++;map(data,function(err,data){n--;queue.push(data);drain()});if(n<width&&!ended)pull()})}var n=0;return function(end,cb){if(end)return read(end,cb);_cb=cb;if(queue.length||ended)pull(),drain();else pull()};return highWaterMark(asyncMap(read,map),width)};var filter=exports.filter=function(read,test){test=tester(test);return function next(end,cb){var sync,loop=true;while(loop){loop=false;sync=true;read(end,function(end,data){if(!end&&!test(data))return sync?loop=true:next(end,cb);cb(end,data)});sync=false}}};var filterNot=exports.filterNot=function(read,test){test=tester(test);return filter(read,function(e){return!test(e)})};var through=exports.through=function(read,op,onEnd){var a=false;function once(abort){if(a||!onEnd)return;a=true;onEnd(abort===true?null:abort)}return function(end,cb){if(end)once(end);return read(end,function(end,data){if(!end)op&&op(data);else once(end);cb(end,data)})}};var take=exports.take=function(read,test){var ended=false;if("number"===typeof test){var n=test;test=function(){return n--}}return function(end,cb){if(ended)return cb(ended);if(ended=end)return read(ended,cb);read(null,function(end,data){if(ended=ended||end)return cb(ended);if(!test(data)){ended=true;read(true,function(end,data){cb(ended,data)})}else cb(null,data)})}};var unique=exports.unique=function(read,field,invert){field=prop(field)||id;var seen={};return filter(read,function(data){var key=field(data);if(seen[key])return!!invert;else seen[key]=true;return!invert})};var nonUnique=exports.nonUnique=function(read,field){return unique(read,field,true)};var group=exports.group=function(read,size){var ended;size=size||5;var queue=[];return function(end,cb){if(end)return read(ended=end,cb);if(ended)return cb(ended);read(null,function next(end,data){if(ended=ended||end){if(!queue.length)return cb(ended);var _queue=queue;queue=[];return cb(null,_queue)}queue.push(data);if(queue.length<size)return read(null,next);var _queue=queue;queue=[];cb(null,_queue)})}};var flatten=exports.flatten=function(read){var _read;return function(abort,cb){if(_read)nextChunk();else nextStream();function nextChunk(){_read(null,function(end,data){if(end)nextStream();else cb(null,data)})}function nextStream(){read(null,function(end,stream){if(end)return cb(end);if(Array.isArray(stream)||stream&&"object"===typeof stream)stream=sources.values(stream);else if("function"!=typeof stream)throw new Error("expected stream of streams");_read=stream;nextChunk()})}}};var prepend=exports.prepend=function(read,head){return function(abort,cb){if(head!==null){if(abort)return read(abort,cb);var _head=head;head=null;cb(null,_head)}else{read(abort,cb)}}};var _reduce=exports._reduce=function(read,reduce,initial){return function(close,cb){if(close)return read(close,cb);if(ended)return cb(ended);sinks.drain(function(item){initial=reduce(initial,item)},function(err,data){ended=err||true;if(!err)cb(null,initial);else cb(ended)})(read)}};var nextTick=process.nextTick;var highWaterMark=exports.highWaterMark=function(read,highWaterMark){var buffer=[],waiting=[],ended,ending,reading=false;highWaterMark=highWaterMark||10;function readAhead(){while(waiting.length&&(buffer.length||ended))waiting.shift()(ended,ended?null:buffer.shift());if(!buffer.length&&ending)ended=ending}function next(){if(ended||ending||reading||buffer.length>=highWaterMark)return;reading=true;return read(ended||ending,function(end,data){reading=false;ending=ending||end;if(data!=null)buffer.push(data);next();readAhead()})}process.nextTick(next);return function(end,cb){ended=ended||end;waiting.push(cb);next();readAhead()}};var flatMap=exports.flatMap=function(read,mapper){mapper=mapper||id;var queue=[],ended;return function(abort,cb){if(queue.length)return cb(null,queue.shift());else if(ended)return cb(ended);read(abort,function next(end,data){if(end)ended=end;else{var add=mapper(data);while(add&&add.length)queue.push(add.shift())}if(queue.length)cb(null,queue.shift());else if(ended)cb(ended);else read(null,next)})}}}).call(this,require("_process"))},{"./sinks":10,"./sources":11,_process:2,"pull-core":9}]},{},[1])(1)});
